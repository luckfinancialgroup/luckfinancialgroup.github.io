<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge"> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- chart js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
<title>Compound Interest; The Income Accelerator</title>
<style>
@-ms-viewport{ width: auto !important; }
body {
	color: #4d4d4d;
	font-size: 14px;
	font-family: Verdana;
	letter-spacing: 1px;
	background-image: url('BG.png');
}
input {
	color: #4d4d4d;
}
h2 {
	font-weight: bold;
	font-size: 24px;
}
table {
	display: inline-block;
	margin-top: 20px;
	margin-bottom: 20px;
	box-shadow: 0 0 20px #333;
}
table * {
	text-align: center;
}
th {
	color: #ffffff;
	background-color: #14446c;
}
#banner {
	background-image: url('bannerBG.png');
}
#assumptions {
	color: #ffffff;
	background-color: #14446c;
	margin-top: 15px;
	margin-bottom: 15px;
	box-shadow: 0 0 20px #333;
}
#luckLogo {
	margin-top: 25px;
	height: 125px;
}
#incomeAccelLogo {
	height: 125px;
}
#assumptionsForm {
	padding-top: 25px;
	padding-bottom: 25px;
}
#assumptionsForm p {
	font-weight: bold;
	font-size: 16px;
}
#initialInvestmentInput, #initialSharePriceInput, #dividendYieldInput, #dividendGrowthRateInput, #yearsInvestedInput {
	padding-top: 12px;
	padding-bottom: 12px;
	padding-left: 15px;
	border: 2px solid #ccc;
	font-weight: bold;
	font-size: 16px;
}
img {
	margin: 15px;
}
.smallTxt {
	font-size: 12px;
}
#detailedView table * {
	padding: 15px;
}
#comparisonViewInvestmentA, #comparisonViewInvestmentB {
	display: table;
	text-align: center;
}
#comparisonViewInvestmentA table {
	box-shadow: 0 0 15px #ff0000;
	margin-left: -15px;
	margin-right: -15px;
}
#comparisonViewInvestmentB table {
	box-shadow: 0 0 15px #0000ff;
	margin-left: -15px;
	margin-right: -15px;
}
#comparisonViewInvestmentA table * {
	padding: 5px;
	padding-top: 15px;
	padding-bottom: 15px;
	letter-spacing: 0px;
}
#comparisonViewInvestmentB table * {
	padding: 5px;
	padding-top: 15px;
	padding-bottom: 15px;
	letter-spacing: 0px;
}
#topBtn {
    display: none; 
    position: fixed; 
    bottom: 40px; 
    right: 40px; 
    z-index: 99; 
    border: none; 
    outline: none; 
    background-color: #14446c;
    color: white;
    cursor: pointer;
    padding: 25px; 
    border-radius: 15px;
}
#topBtn:hover {
    background-color: #555; /* Add a dark-grey background on hover */
}
</style>
</head>
	
<body>

<div id='banner' class='container-fluid'>
	<div class='row'>
		<div class='col-lg-8 text-left'>
			<img id='incomeAccelLogo' src='incomeAccelLogo.png'/>
		</div>
		<div class='col-lg-4 text-right'>
			<img id='luckLogo' src='luckLogo.png'/>
		</div>
	</div>
	<div class='row'>
		<hr style='color: #185281; border-color: #185281; background-color: #185281; margin: 10px'/>	
	</div>
</div>

<div id='assumptions' class='container-fluid'>	
	<div class='container-fluid text-center'>
		<form id='assumptionsForm'>
			<div class='row'>
				<div class='col-lg-1'></div>
				<div class='col-lg-2'>
					<p>Initial<br/>Investment</p>
					<input id='initialInvestmentInput' value='$100,000.00' size=14 required></input>
				</div>
				<div class='col-lg-2'>
					<p>Initial<br/>Share Price</p>
					<input id='initialSharePriceInput' value='$100.00' size=14 required></input>
				</div>
				<div class='col-lg-2'>
					<p>Dividend<br/>Yield</p>
					<input id='dividendYieldInput' value='5.00%' size=14 required></input>
				</div>
				<div class='col-lg-2'>
					<p>Dividend<br/>Growth Rate</p>
					<input id='dividendGrowthRateInput' value='5.00%' size=14 required></input>
				</div>
				<div class='col-lg-2'>
					<p>Years<br/>Invested</p>
					<input id='yearsInvestedInput' value='5' size=14 required></input>
				</div>
				<div class='col-lg-1'></div>
			</div>
			<br/>
			<input type='submit' value='Submit' class='btn btn-default'></input>
		</form>
	</div>
</div>

<div id='viewToggle' hidden>
	<ul class='nav nav-pills nav-justified'>
		<li onmousedown='detailedViewToggle();'><a>Detailed View</a></li>
		<li onmousedown='comparisonViewToggle();'><a>Comparison View</a></li>
	</ul>
</div>

<div id='detailedView' hidden>
	<p class='row text-center'>
		Browse Scenarios  :
		<a href='#detailedViewInvestment1'>1</a>
		<a href='#detailedViewInvestment2'>2</a>
		<a href='#detailedViewInvestment3'>3</a>
		<a href='#detailedViewInvestment4'>4</a>
	</p>
	
	<hr/>
	
	<div class='container-fluid text-center'>
		<div id='detailedViewInvestment1'></div>
	</div>
	
	<hr/>
	
	<div class='container-fluid text-center'>
		<div id='detailedViewInvestment2'></div>
	</div>
	
	<hr/>
	
	<div class='container-fluid text-center'>
		<div id='detailedViewInvestment3'></div>
	</div> 
	<br/>
	<div class='container-fluid text-center'>
		<div class='col-lg-6'>
			<canvas id='chartInvestment3'></canvas>
		</div>
		<div class='col-lg-6'>
			<canvas id='chartIncomeInvestment3'></canvas>
		</div>
	</div>
	
	<hr/>
	
	<div class='container-fluid text-center'>
		<div id='detailedViewInvestment4'></div>
	</div>
	<br/>
	<div class='container-fluid text-center'>
		<div class='col-lg-6'>
			<canvas id='chartInvestment4'></canvas>
		</div>
		<div class='col-lg-6'>
			<canvas id='chartIncomeInvestment4'></canvas>
		</div>
	</div>
</div>

<div id='comparisonView' hidden>
	<div class='container-fluid text-center'>
		<p>Please select two scenarios:</p>
		<div class='col-lg-6'>
			<select id='selectScenarioA' class='form-control' onchange='setScenarioA()'>
				<option>1</option>
				<option>2</option>
				<option>3</option>
				<option>4</option>
			</select>
		</div>
		<div class='col-lg-6'>
			<select id='selectScenarioB' class='form-control' onchange='setScenarioB()'>
				<option>1</option>
				<option>2</option>
				<option>3</option>
				<option>4</option>
			</select>
		</div>
	</div>
	
	<hr/>
	
	<div class='container-fluid text-center'>
		<div id='comparisonViewInvestmentA' class='col-lg-6'></div>
		<div id='comparisonViewInvestmentB' class='col-lg-6'></div>
	</div>
	
	<hr/>
	
	<div class='container-fluid text-center'>
		<div class='col-lg-2'></div>
		<div class='col-lg-8'>
			<canvas id='chartCompareInvestments'></canvas>
		</div>
		<div class='col-lg-2'></div>
	</div>
	
	<div id='comparisonViewInvestment1' hidden></div>
	<div id='comparisonViewInvestment2' hidden></div>
	<div id='comparisonViewInvestment3' hidden></div>
	<div id='comparisonViewInvestment4' hidden></div>
</div>

<div id='modalAdjustRates' class='modal fade' role='dialog'>
  <div class='modal-dialog'>
    <div class='modal-content'>
	    <div class='modal-body'>
			<div id='adjustRatesView'></div>
        </div>
    </div>
  </div>
</div>

<div id='footer' class='container' style='width: 100%'>
	<p class='text-muted credit smallTxt'>
		This <b><i>Income Accelerator</i></b> illustration is for discussion purposes only. 
		Information contained herein is obtained from sources believed to be reliable, but is not guaranteed. 
		Calculations/projections are based on a number of assumptions; actual results may differ.
		Yields/rates are as of the date of this report unless otherwise noted. 
		This report has been created by, and is the sole property and copyright of Darren Luck. 
		This report is provided exclusively for the clients of Darren Luck and the Luck Financial Group of CIBC Wood Gundy under licence. 
		The Income Accelerator report and its contents are the sole property of Darren Luck and the image or any likeness, in whole or in part may not be reproduced, disseminated, published or copied in any way.
		<br/>
		&copy; 2017 Darren Luck.
		<i>CIBC Wood Gundy is a division of CIBC World Markets Inc., a subsidiary of CIBC and a Member of the Canadian Investor Protection Fund and Investment Industry Regulatory Organization of Canada</i>.
	</p>
</div>

<!-- https://www.w3schools.com/howto/howto_js_scroll_to_top.asp -->

<button onclick="topFunction()" id="topBtn" title="Back to Top"><span class="glyphicon glyphicon-menu-up"></button>

<script>
// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
        document.getElementById("topBtn").style.display = "block";
    } else {
        document.getElementById("topBtn").style.display = "none";
    }
}

// When the user clicks on the button, scroll to the top of the document
function topFunction() {
    document.body.scrollTop = 0; // For Chrome, Safari and Opera 
    document.documentElement.scrollTop = 0; // For IE and Firefox
}

var investment1;
var investment2;
var investment3;
var investment4;

var chartInvestment3;
var chartIncomeInvestment3;

var chartInvestment4;
var chartIncomeInvestment4;

var chartCompareInvestments;

$(document).ready(function() {
	
	$('#assumptionsForm').on('submit', function () {

		var initialInvestment = $('#initialInvestmentInput').val().replace(/([$]|[,]|[ ])+/g, '');
		var initialSharePrice = $('#initialSharePriceInput').val().replace(/([$]|[,]|[ ])+/g, '');
		var dividendYield = $('#dividendYieldInput').val().replace(/([%]|[,]|[ ])+/g, '');
		var dividendGrowthRate = $('#dividendGrowthRateInput').val().replace(/([%]|[,]|[ ])+/g, '');
		var yearsInvested = $('#yearsInvestedInput').val();
			
		var rex = /^[0-9]+([.][0-9]+){0,1}$/ig;
		if(!initialInvestment.match(rex)){
			alert('Invalid Input - Initial Investment');
			return false;
		}
		if(!initialSharePrice.match(rex)){
			alert('Invalid Input - Share Price');
			return false;
		}
		if(!dividendYield.match(rex)){
			alert('Invalid Input - Dividend Yield');
			return false;
		}
		if(!dividendGrowthRate.match(rex)){
			alert('Invalid Input - Dividend Growth Rate');
			return false;
		}
		if(!yearsInvested.match(/^[0-9]{1,2}$/ig)){
			alert('Invalid Input - Years Invested');
			return false;
		}
		
		// Convert Strings to Numbers
		initialInvestment = initialInvestment * 1;
		initialSharePrice = initialSharePrice * 1;
		dividendYield = dividendYield * 0.01;
		dividendGrowthRate = dividendGrowthRate * 0.01;
		yearsInvested = yearsInvested * 1;
		
		$('#initialInvestInput').val(parseCurrency(initialInvestment));
		$('#inititialSharePriceInput').val(parseCurrency(initialSharePrice));
		$('#dividendYieldInput').val(parsePercentage(dividendYield * 100));
		$('#dividendGrowthRateInput').val(parsePercentage(dividendGrowthRate * 100));
		$('#yearsInvestedInput').val(yearsInvested);
		
		$('#viewToggle').show();
		detailedViewToggle();
		
		// false - Cash Paid Strategy
		// true - Dividend Reinvestment Strategy
		
		investment1 = new Investment(initialInvestment, initialSharePrice, dividendYield, dividendGrowthRate, yearsInvested, dividendsReinvested=false);
		investment1.performStrategy();
		//console.log(investment1);
		
		investment2 = new Investment(initialInvestment, initialSharePrice, dividendYield, dividendGrowthRate, yearsInvested, dividendsReinvested=true);
		investment2.performStrategy();
		//console.log(investment2);
		
		investment3 = new Investment(initialInvestment, initialSharePrice, dividendYield, dividendGrowthRate, yearsInvested, dividendsReinvested=true);
		investment3.performStrategy();
		//console.log(investment3);
		
		investment4 = new Investment(initialInvestment, initialSharePrice, dividendYield, dividendGrowthRate, yearsInvested, dividendsReinvested=true);
		investment4.performStrategy();
		//console.log(investment4);
		
		$('#detailedViewInvestment1').html(getDetailedView(investment1, scenarioNumber=1));
		$('#detailedViewInvestment2').html(getDetailedView(investment2, scenarioNumber=2));
		$('#detailedViewInvestment3').html(getDetailedView(investment3, scenarioNumber=3));
		$('#detailedViewInvestment4').html(getDetailedView(investment4, scenarioNumber=4));
		
		$('#comparisonViewInvestment1').html(getComparisonView(investment1, scenarioNumber=1));
		$('#comparisonViewInvestment2').html(getComparisonView(investment2, scenarioNumber=2));
		$('#comparisonViewInvestment3').html(getComparisonView(investment3, scenarioNumber=3));
		$('#comparisonViewInvestment4').html(getComparisonView(investment4, scenarioNumber=4));
		
		setCharts();
		
		return false;
	});
});

function detailedViewToggle(){
	$('#detailedView').show();
	$('#comparisonView').hide();
	return false;
}

function comparisonViewToggle(){
	$('#detailedView').hide();
	$('#comparisonView').show();
	$('#selectScenarioA').val(3);
	$('#selectScenarioB').val(4);
	setScenarioA();
	setScenarioB();
	setCharts();
	return false;
}

function setScenarioA(){
	$('#comparisonViewInvestmentA').html(
		$('#comparisonViewInvestment' + $("#selectScenarioA").val()).html()
	);
	setChartCompare($("#selectScenarioA").val(), $("#selectScenarioB").val());
}

function setScenarioB(){
	$('#comparisonViewInvestmentB').html(
		$('#comparisonViewInvestment' + $("#selectScenarioB").val()).html()
	);
	setChartCompare($("#selectScenarioA").val(), $("#selectScenarioB").val());
}

function getInvestmentTitle(investment, scenarioNumber) {
	if(scenarioNumber == 1){
		return 'Scenario ' + scenarioNumber + ' : ' + parsePercentage(investment.dividendYield * 100) + ' Dividend (Cash Paid), ' + parsePercentage(investment.dividendGrowthRate * 100) + ' Dividend Growth Rate, and No Volatility';
	} else if(scenarioNumber == 2){
		return 'Scenario ' + scenarioNumber + ' : ' + parsePercentage(investment.dividendYield * 100) + ' Dividend (Dividends Reinvested), ' + parsePercentage(investment.dividendGrowthRate * 100) + ' Dividend Growth Rate, and No Volatility';
	} else {
		return 'Scenario ' + scenarioNumber + ' : ' + parsePercentage(investment.dividendYield * 100) + ' Dividend (Dividends Reinvested), ' + parsePercentage(investment.dividendGrowthRate * 100) + ' Dividend Growth Rate, and Share Price Volatility';
	}
}

function getInvestment(scenarioNumber){
	if(scenarioNumber == 1){
		return investment1;
	} else if(scenarioNumber == 2){
		return investment2;
	} else if(scenarioNumber == 3){
		return investment3;
	} else if(scenarioNumber == 4){
		return investment4;
	} else {
		return null;
	}
}

function setSharePrice(sharePrice, position, scenarioNumber){
	
	var investment = getInvestment(scenarioNumber);
	
	if(position == 0){
		investment.initialSharePrice = sharePrice;
	}
	
	investment.sharePriceList[position] = sharePrice;
	investment.performStrategy();
	
	$('#detailedViewInvestment' + scenarioNumber).html(getDetailedView(investment, scenarioNumber));
	$('#comparisonViewInvestment' + scenarioNumber).html(getComparisonView(investment, scenarioNumber));
	setScenarioA();
	setScenarioB();
	setCharts();
}

// For IE: input blur on Enter
function checkSetSharePriceEnter(event, sharePrice, position, scenarioNumber){
	if(event.keyCode == 13 || event.which == 13){
		event.currentTarget.blur();
	}
}


function adjustRates(scenarioNumber){
	
	var investment = getInvestment(scenarioNumber);
	
	var adjustDividendYield = $('#adjustDividendYieldInput').val().replace(/([%]|[,]|[ ])+/g, '');
	var adjustDividendGrowthRate = $('#adjustDividendGrowthRateInput').val().replace(/([%]|[,]|[ ])+/g, '');
	
	var rex = /^[0-9]+([.][0-9]+){0,1}$/ig;
	if(!adjustDividendYield.match(rex)){
		alert('Invalid Input - Dividend Yield');
		return false;
	}
	if(!adjustDividendGrowthRate.match(rex)){
		alert('Invalid Input - Dividend Growth Rate');
		return false;
	}
	
	$('#modalAdjustRates').modal('toggle');
		
	adjustDividendYield = adjustDividendYield * 0.01;
	adjustDividendGrowthRate = adjustDividendGrowthRate * 0.01;
	
	investment.dividendYield = adjustDividendYield;
	investment.dividendGrowthRate = adjustDividendGrowthRate;
	investment.performStrategy();
	
	$('#detailedViewInvestment' + scenarioNumber).html(getDetailedView(investment, scenarioNumber));
	$('#comparisonViewInvestment' + scenarioNumber).html(getComparisonView(investment, scenarioNumber));
	setScenarioA();
	setScenarioB();
	setCharts();
	
	return false;
}

function getAdjustRatesForm(scenarioNumber){
	
	var investment = getInvestment(scenarioNumber);
	
	var html = "";
	
	html += "<form id='adjustRatesForm' onsubmit='return adjustRates(" + scenarioNumber + ")'>";
	
	html += "<p>Dividend Yield : <input id='adjustDividendYieldInput' value='" + parsePercentage(investment.dividendYield * 100) + "'></input></p>";
	html += "<p>Dividend Growth Rate : <input id='adjustDividendGrowthRateInput' value='" + parsePercentage(investment.dividendGrowthRate * 100) + "'></input></p>";
	
	html += "<input type='submit' value='Submit'></input>";
	
	html += "</form>";
	
	$('#adjustRatesView').html(html);
}

function getDetailedView(investment, scenarioNumber){
		
		var html = "";
		
		// Title
		html += "<h2>" + getInvestmentTitle(investment, scenarioNumber) + "</h2>";
		
		// Allow user to change: Dividend Yield, and Dividend Growth Rate
		html += "<button type='button' class='btn btn-default' data-toggle='modal' data-target='#modalAdjustRates' onclick='getAdjustRatesForm(" + scenarioNumber + ")'>Adjust Percentages</button> <br/>";
		
		html += "<table class='table-striped'>";
		
		// Display column headers 
		html += "<tr>";
		html += "<th rowspan=2>Year</th> <th rowspan=2>Share<br/>Price</th> <th rowspan=2>Number of<br/>Shares</th> <th rowspan=2>Additional<br/>Shares<br/>Purchased</th> <th rowspan=2>Value</th>  <th rowspan=2>Income</th> <th rowspan=2>Yield *</th> <th rowspan=2>Cumulative<br/>Income</th> <th colspan=2>Account Value</th>";
		html += "</tr>";
		html += "<tr>";
		html += "<th>Start of Year</th> <th>End of Year</th>";
		html += "</tr>";
	
		for(var i = 0 ; i < investment.yearsInvested ; i++){
			html += "<tr>";
			
			// Year
			html += "<td>" + (i + 1) + "</td>";
			
			// Share Price
			if(scenarioNumber == 3 || scenarioNumber == 4){
				html += "<td>$<input onblur='setSharePrice(this.value," + i + "," + scenarioNumber + ")' value='" + parseCommas(parseFloat(investment.sharePriceList[i]).toFixed(2)) + "' size=6 onkeypress='checkSetSharePriceEnter(event, this.value," + i + "," + scenarioNumber + ")'></input></td>";
			} else {
				html += "<td>" + parseCurrency(investment.sharePriceList[i]) + "</td>";
			}
			
			// Number of Shares
			html += "<td>" + parseInt(investment.data.numberOfSharesList[i]) + "</td>";
	
			// Additional Shares Purchased
			html += "<td style='font-weight: bold; color: #009900; background-color: #ffffb3'>" + parseInt(investment.data.additionalSharesPurchasedList[i]) + "</td>";
			
			// Account Value
			var accountValue = investment.data.accountValueList[i];
			if(accountValue < investment.initialInvestment){
				html += "<td style='color: red'>";
			} else {
				html += "<td>";
			}
			html += parseCurrency(accountValue) + "</td>";
			
			// Income
			html += "<td style='font-weight: bold; background-color: #ffffb3'>" + parseCurrency(investment.data.incomeList[i]) + "</td>";
			
			// Yield *
			html += "<td>" + parsePercentage(investment.data.yieldList[i] * 100) + "</td>";
			
			// Cumulative Income
			html += "<td>" + parseCurrency(investment.data.cumulativeIncomeList[i]) + "</td>";
			
			// Account Value (Start of Year)
			var accountValueStart = investment.data.accountValueStartList[i];	
			if(accountValueStart < investment.initialInvestment){
				html += "<td style='color: red'><b>";
			} else {
				html += "<td><b>";
			}	
			html += parseCurrency(accountValueStart) + "</b></td>";
			
			// Account Value (End of Year)
			var accountValueEnd = investment.data.accountValueEndList[i];
			if(accountValueEnd < investment.initialInvestment){
				html += "<td style='color: red'><b>";
			} else {
				html += "<td><b>";
			}
			html += parseCurrency(accountValueEnd) + "</b></td>";
			
			html += "</tr>";
		}
		
		// Display column headers: Total Shares Purchased and Total Income Paid
		html +=" <tr>";
		html += "<th colspan=3></th>";
		html += "<th>Total<br/>Shares<br/>Purchased</th>";
		html += "<th colspan=1></th>";
		html += "<th>Total<br/>Income<br/>Paid</th>";
		html += "<th colspan=4></th>";
		html += "</tr>";
		
		// Display values for Total Shares Purchased and Total Income Paid
		html +="<tr>";
		html += "<td colspan=3></th>";
		html += "<td style='color: #009900; background-color: #ffffb3'><b>" + parseInt(investment.getTotalSharesPurchased()) + "</b></td>";
		html += "<td colspan=1></th>";
		html += "<td style='background-color: #ffffb3'><b>" + parseCurrency(investment.getTotalIncomePaid()) + "</b></td>";
		html += "<td colspan=4></td>";
		html += "</tr>";
		
		html += "</table>";
		
		html += "<p class='smallTxt'>* : Based on Initial Investment</p>";
		html += "<br/>";
		
		html += "<div class='container-fluid text-center'>";
		
		// Net Total Return
		html += "<div class='col-lg-4'>Net Total Return: <b>" + parsePercentage(investment.getNetTotalReturn() * 100) + " (" + parsePercentage(investment.getNetTotalReturnCompounded() * 100) + " Compound)</b></div>";
		
		// Income Growth
		html += "<div class='col-lg-2'>Income Growth: <b>" + parsePercentage(investment.getIncomeGrowth() * 100) + "</b></div>";
		
		
		// Income Paid, Wealth Created, and Net Profit
		html += "<div class='col-lg-6'>";
		html += "Income Paid: <b>" + parseCurrency(investment.getTotalIncomePaid()) + "</b>";	
		html += " + ";
		html += "Wealth Created: <b>" + parseCurrency(investment.getWealthCreated()) + "</b>";
		html += " = ";
		html += "Net Profit: <b>" + parseCurrency(investment.getNetProfit()) + "</b>";
		html += "</div>";
		
		html += "</div>";
		
		return html;
}

function getComparisonView(investment, scenarioNumber){
		
		var html = "";
		
		// Title
		html += "<h2>" + getInvestmentTitle(investment, scenarioNumber) + "</h2>";
		
		// Allow user to change: Dividend Yield, and Dividend Growth Rate
		html += "<button type='button' class='btn btn-default' data-toggle='modal' data-target='#modalAdjustRates' onclick='getAdjustRatesForm(" + scenarioNumber + ")'>Adjust Percentages</button> <br/>";
		
		html += "<table class='table-striped'>";
		
		// Display column headers 
		html += "<tr>";
		html += "<th rowspan=2>Year</th> <th rowspan=2>Share<br/>Price</th> <th rowspan=2>Number of<br/>Shares</th> <th rowspan=2>Income</th> <th rowspan=2>Yield *</th> <th colspan=2>Account Value</th>";
		html += "</tr>";
		html += "<tr>";
		html += "<th>Start of<br/>Year</th> <th>End of<br/>Year</th>";
		html += "</tr>";
	
		for(var i = 0 ; i < investment.yearsInvested ; i++){
			html += "<tr>";
			
			// Year
			html += "<td>" + (i + 1) + "</td>";
			
			// Share Price
			if(scenarioNumber == 3 || scenarioNumber == 4){
				html += "<td>$<input onblur='setSharePrice(this.value," + i + "," + scenarioNumber + ")' value='" + parseCommas(parseFloat(investment.sharePriceList[i]).toFixed(2)) + "' size=6 onkeypress='checkSetSharePriceEnter(event, this.value," + i + "," + scenarioNumber + ")'></input></td>";
			} else {
				html += "<td>" + parseCurrency(investment.sharePriceList[i]) + "</td>";
			}
			
			// Number of Shares
			html += "<td>" + parseInt(investment.data.numberOfSharesList[i]) + "</td>";
	
			// Income
			html += "<td style='font-weight: bold; background-color: #ffffb3'>" + parseCurrency(investment.data.incomeList[i]) + "</td>";
			
			// Yield *
			html += "<td>" + parsePercentage(investment.data.yieldList[i] * 100) + "</td>";
			
			// Account Value (Start of Year)
			var accountValueStart = investment.data.accountValueStartList[i];	
			if(accountValueStart < investment.initialInvestment){
				html += "<td style='color: red'><b>";
			} else {
				html += "<td><b>";
			}	
			html += parseCurrency(accountValueStart) + "</b></td>";
			
			// Account Value (End of Year)
			var accountValueEnd = investment.data.accountValueEndList[i];
			if(accountValueEnd < investment.initialInvestment){
				html += "<td style='color: red'><b>";
			} else {
				html += "<td><b>";
			}
			html += parseCurrency(accountValueEnd) + "</b></td>";
			
			html += "</tr>";
		}
		
		// Display column headers: Total Shares Purchased and Total Income Paid
		html +=" <tr>";
		html += "<th colspan=3></th>";
		html += "<th>Total<br/>Income<br/>Paid</th>";
		html += "<th colspan=6></th>";
		html += "</tr>";
		
		// Display values for Total Shares Purchased and Total Income Paid
		html +="<tr>";
		html += "<td colspan=3></th>";
		html += "<td style='background-color: #ffffb3'><b>" + parseCurrency(investment.getTotalIncomePaid()) + "</b></td>";
		html += "<td colspan=6></td>";
		html += "</tr>";
		
		html += "</table>";
		
		html += "<p class='smallTxt'>* : Based on Initial Investment</p>";
		html += "<br/>";
		
		// Net Total Return
		html += "<p>Net Total Return: <b>" + parsePercentage(investment.getNetTotalReturn() * 100) + " (" + parsePercentage(investment.getNetTotalReturnCompounded() * 100) + " Compound)</b></p>";
		html += "<br/>";
		
		// Income Growth
		html += "<p>Income Growth: <b>" + parsePercentage(investment.getIncomeGrowth() * 100) + "</b><p>";
		html += "<br/>";
		
		// Income Paid, Wealth Created, and Net Profit
		html += "<p>Income Paid: <b>" + parseCurrency(investment.getTotalIncomePaid()) + "</b></p>";	
		html += "<p>Wealth Created: <b>" + parseCurrency(investment.getWealthCreated()) + "</b></p>";
		html += "<p>Net Profit: <b>" + parseCurrency(investment.getNetProfit()) + "</b></p>";
		
		return html;
}

function setCharts(){
	
	if(chartInvestment3){
		chartInvestment3.destroy();
	}
	if(chartInvestment4){
		chartInvestment4.destroy();
	}
	
	chartInvestment3 = getChart(scenarioNumber=3);
	chartInvestment4 = getChart(scenarioNumber=4);
	
	if(chartIncomeInvestment3){
		chartIncomeInvestment3.destroy();
	}
	if(chartIncomeInvestment4){
		chartIncomeInvestment4.destroy();
	}
	
	chartIncomeInvestment3 = getChartIncome(scenarioNumber=3);
	chartIncomeInvestment4 = getChartIncome(scenarioNumber=4);
}

function getChart(scenarioNumber){

	var investment = getInvestment(scenarioNumber);
	var ctx = document.getElementById('chartInvestment' + scenarioNumber).getContext('2d');
	
	return new Chart(ctx, {
		type: 'line',
		data: {
			labels: range(1, 1 + investment.yearsInvested),
			datasets: [
			{
				label: 'Value',
				borderColor: 'rgb(0, 255, 0)',
				data: investment.data.accountValueEndList,
				yAxisID: "y-axis-0",
				backgroundColor: 'rgba(0, 255, 0, 0.4)',
				fill: "1"
			},{
				label: 'Initial Value' ,
				borderColor: 'rgb(0, 0, 255)' ,
				data: fillList(investment.initialInvestment, investment.yearsInvested),
				yAxisID: "y-axis-0",
				backgroundColor: 'rgba(0, 0, 255, 0.6)',
				fill: true
			}]
		},
		options: {
		    title: {
				display: true,
				text: 'Scenario ' + scenarioNumber + ' - Investment Over Time'
			},
			scales: {
				yAxes: 
				[
					{
						position: "left",
						"id": "y-axis-0",
						ticks:{
							min: 0,
							// https://stackoverflow.com/questions/28523394/charts-js-formatting-y-axis-with-both-currency-and-thousands-separator
							callback: function(value, index, values) {
							  if(parseInt(value) >= 1000){
								return '$' + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
							  } else {
								return '$' + value;
							  }
							}
						},
					}
				]
			}
		}
	});
}

function getChartIncome(scenarioNumber){

	var investment = getInvestment(scenarioNumber);
	var ctx = document.getElementById('chartIncomeInvestment' + scenarioNumber).getContext('2d');
	
	return new Chart(ctx, {
		type: 'bar',
		data: {
			labels: range(1, 1 + investment.yearsInvested),
			datasets: [{
				label: 'Income',
				borderColor: 'rgb(102, 217, 255)',
				data: investment.data.incomeList,
				yAxisID: "y-axis-1",
				backgroundColor: 'rgba(102, 217, 255, 0.6)',
			},{
				label: 'Cumulative Income',
				borderColor: 'rgb(0, 0, 128)',
				data: investment.data.cumulativeIncomeList,
				yAxisID: "y-axis-1",
				backgroundColor: 'rgba(0, 0, 128, 0.6)',
			}]
		},
		options: {
			title: {
				display: true,
				text: 'Scenario ' + scenarioNumber + ' - Income Over Time'
			},
			scales: {
				xAxes: [{
						stacked: true,
					}
				],
				yAxes:
				[
					{
						position: "left",
						"id": "y-axis-1",
						ticks:{
							min: 0, 
							// https://stackoverflow.com/questions/28523394/charts-js-formatting-y-axis-with-both-currency-and-thousands-separator
							callback: function(value, index, values) {
							  if(parseInt(value) >= 1000){
								return '$' + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
							  } else {
								return '$' + value;
							  }
							}
						},
					}
				]
			}
		}
	});
}

function setChartCompare(scenarioNumberA, scenarioNumberB){
	
	if(chartCompareInvestments){
		chartCompareInvestments.destroy();
	}
	
	chartCompareInvestments = getChartCompare(scenarioNumberA, scenarioNumberB);
}

function getChartCompare(scenarioNumberA, scenarioNumberB){
	
	var investmentA = getInvestment(scenarioNumberA);
	var investmentB = getInvestment(scenarioNumberB);
	var ctx = document.getElementById('chartCompareInvestments').getContext('2d');

	return new Chart(ctx, {
		type: 'bar',
		data: {
			labels: range(1, 1 + investmentA.yearsInvested),
			datasets: [{
				type: 'line',
				label: 'Scenario ' + scenarioNumberA + ' - Value',
				borderColor: 'rgb(255, 0, 0)',
				data: investmentA.data.accountValueEndList,
				yAxisID: "y-axis-0",
				backgroundColor: 'rgba(255, 0, 0, 0.6)',
				fill: false
			},{
				label: 'Scenario ' + scenarioNumberA + ' - Additional Shares Purchased',
				borderColor: 'rgb(255, 0, 0)',
				data: investmentA.data.additionalSharesPurchasedList,
				yAxisID: "y-axis-1",
				backgroundColor: 'rgba(255, 0, 0, 0.6)',
			},{
				type: 'line',
				label: 'Scenario ' + scenarioNumberB + ' - Value',
				borderColor: 'rgb(0, 0, 255)',
				data: investmentB.data.accountValueEndList,
				yAxisID: "y-axis-0",
				backgroundColor: 'rgba(0, 0, 255, 0.6)',
				fill: false,
			},{
				label: 'Scenario ' + scenarioNumberB + ' - Additional Shares Purchased',
				borderColor: 'rgb(0, 0, 255)',
				data: investmentB.data.additionalSharesPurchasedList,
				yAxisID: "y-axis-1",
				backgroundColor: 'rgba(0, 0, 255, 0.6)',
			}]
		},
		options: {
			title: {
				display: true,
				text: 'Comparison of Scenarios'
			},
			scales: {
				xAxes: [{
						//stacked: true,
					}
				],
				yAxes:
				[
					{
						position: "left",
						"id": "y-axis-0",
						ticks:{
							min: 0, 
							// https://stackoverflow.com/questions/28523394/charts-js-formatting-y-axis-with-both-currency-and-thousands-separator
							callback: function(value, index, values) {
							  if(parseInt(value) >= 1000){
								return '$' + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
							  } else {
								return '$' + value;
							  }
							}
						},
					},
					{	
						position: "right",
						"id": "y-axis-1",
						ticks:{
							min: 0, 
							max: (
								Math.round(
									(
										Math.max(
											Math.max.apply(null, investmentA.data.additionalSharesPurchasedList), Math.max.apply(null, investmentB.data.additionalSharesPurchasedList)
										) 
									) * 
									Math.ceil(
										Math.max(maxOfList(investmentA.data.accountValueEndList), maxOfList(investmentB.data.accountValueEndList)) / investmentA.initialInvestment
									) 
								) / 10 
							) * 10 
						},
					}
				]
			}
		}
	});
	
}

function Investment(initialInvestment, initialSharePrice, dividendYield, dividendGrowthRate, yearsInvested, dividendsReinvested){

	this.initialInvestment = initialInvestment;
	this.initialSharePrice = initialSharePrice;
	this.dividendYield = dividendYield;
	this.dividendGrowthRate = dividendGrowthRate;
	this.yearsInvested = yearsInvested;
	
	// True, if this investment is on the dividend reinvestment strategy
	this.dividendsReinvested = dividendsReinvested;
	
	this.sharePriceList = fillList(this.initialSharePrice, this.yearsInvested);
	
	this.data;
	
	this.performCashPaidStrategy = function(){
		//console.log('cash paid strategy called!');
		this.data = new InvestmentData();
		for(var i = 0 ; i < this.yearsInvested ; i++){
			// Number of Shares
			this.data.numberOfSharesList.push(this.initialInvestment / this.initialSharePrice);
			// Additional Shares Purchased
			this.data.additionalSharesPurchasedList.push(0);
			// Income
			if(i == 0){
				this.data.incomeList.push(this.initialSharePrice * this.data.numberOfSharesList[i] * this.dividendYield);
			} else {
				this.data.incomeList.push(this.data.incomeList[i - 1] * (1 + this.dividendGrowthRate));
			}
			// Cumulative Income
			if(i == 0){
				this.data.cumulativeIncomeList.push(this.data.incomeList[i]);
			} else {
				this.data.cumulativeIncomeList.push(this.data.incomeList[i] + this.data.cumulativeIncomeList[i - 1]);
			}
			// Yield *
			this.data.yieldList.push(this.data.incomeList[i] / this.initialInvestment);			
			// Account Value
			this.data.accountValueList.push(this.sharePriceList[i] * this.data.numberOfSharesList[i]);
			// Account Value - Start of Year
			if(i == 0){
				this.data.accountValueStartList.push(this.sharePriceList[i] * this.data.numberOfSharesList[i]);
			} else {
				this.data.accountValueStartList.push(this.sharePriceList[i] * this.data.numberOfSharesList[i] + this.data.cumulativeIncomeList[i - 1]);
			}
			// Account Value - End of Year
			this.data.accountValueEndList.push(this.sharePriceList[i] * this.data.numberOfSharesList[i] + this.data.cumulativeIncomeList[i]);
		}
	}	
	
	this.performDividendReinvestmentStrategy = function(){
		//console.log('dividend reinvestment strategy called!');
		this.data = new InvestmentData();
		for(var i = 0 ; i < this.yearsInvested ; i++){
			// Number of Shares
			if(i == 0){
				this.data.numberOfSharesList.push(this.initialInvestment / this.initialSharePrice);
			} else {
				this.data.numberOfSharesList.push(this.data.numberOfSharesList[i - 1] + (this.data.incomeList[i - 1] / this.sharePriceList[i]));
			}
			// Additional Shares Purchased
			if(i == 0){
				this.data.additionalSharesPurchasedList.push(0);
			} else {
				this.data.additionalSharesPurchasedList.push(this.data.numberOfSharesList[i] - this.data.numberOfSharesList[i - 1]);
			}
			// Income
			if(i == 0){
				this.data.incomeList.push(this.initialSharePrice * this.data.numberOfSharesList[i] * this.dividendYield);
			} else {
				// Might be wrong..
				//this.data.incomeList.push(this.initialSharePrice * this.data.numberOfSharesList[i] * this.dividendYield * (1 + this.dividendGrowthRate));
				// Might be correct..
				this.data.incomeList.push(this.data.incomeList[i - 1] * (1 + this.dividendGrowthRate) + this.initialSharePrice * this.data.additionalSharesPurchasedList[i] * this.dividendYield);
			}
			// Cumulative Income
			if(i == 0){
				this.data.cumulativeIncomeList.push(this.data.incomeList[i]);
			} else {
				this.data.cumulativeIncomeList.push(this.data.incomeList[i] + this.data.cumulativeIncomeList[i - 1]);
			}
			// Yield *
			this.data.yieldList.push(this.data.incomeList[i] / this.initialInvestment);
			// Account Value
			this.data.accountValueList.push(this.sharePriceList[i] * this.data.numberOfSharesList[i]);
			// Account Value - Start of Year
			this.data.accountValueStartList.push(this.sharePriceList[i] * this.data.numberOfSharesList[i]);
			// Account Value - End of Year
			this.data.accountValueEndList.push(this.sharePriceList[i] * this.data.numberOfSharesList[i] + this.data.incomeList[i]);
		}
	}
	
	this.performStrategy = function(){
		if(this.dividendsReinvested){
			this.performDividendReinvestmentStrategy();
		} else {
			this.performCashPaidStrategy();
		}
	}
	
	this.getTotalSharesPurchased = function(){
		return sumList(this.data.additionalSharesPurchasedList);
	}
	
	this.getTotalIncomePaid = function(){
		return sumList(this.data.incomeList);
	}
	
	this.getNetTotalReturn = function(){
		return (this.data.accountValueEndList[this.yearsInvested - 1] / this.initialInvestment) - 1;
	}
	
	this.getNetTotalReturnCompounded = function(){
		return Math.pow(this.data.accountValueEndList[this.yearsInvested - 1] / this.initialInvestment, 1 / this.yearsInvested) - 1;
	}
	
	this.getIncomeGrowth = function(){
		return (this.data.incomeList[this.yearsInvested - 1] / this.data.incomeList[0]) - 1;
	}
	
	this.getWealthCreated = function(){
		return this.data.accountValueEndList[this.yearsInvested - 1] - this.initialInvestment - this.getTotalIncomePaid();
	}
	
	this.getNetProfit = function(){
		return this.data.accountValueEndList[this.yearsInvested - 1] - this.initialInvestment;
	}
}

function InvestmentData(){
	this.numberOfSharesList = [];
	this.additionalSharesPurchasedList = [];
	this.yieldList = [];
	this.incomeList = [];
	this.cumulativeIncomeList = [];
	this.accountValueList = [];
	this.accountValueStartList = [];
	this.accountValueEndList = [];
}

// UTILITY FUNCTIONS

// Get maximum value of a list
// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/max
function maxOfList(numArray) {
  return Math.max.apply(null, numArray);
}

// Get list ranging from: start to end - 1
// https://stackoverflow.com/questions/3746725/create-a-javascript-array-containing-1-n
function range(start, end) {
    var foo = [];
    for (var i = start; i < end; i++) {
        foo.push(i);
    }
    return foo;
}

// Sum of elements in list
function sumList(arr){
	sum = 0;
	for(var i = 0 ; i < arr.length ; i++){
		sum += arr[i];
	}
	return sum;
}

// Fill list of size N with the same element
// https://stackoverflow.com/questions/12503146/create-an-array-with-same-element-repeated-multiple-times-in-javascript
function fillList(value, len) {
  var arr = [];
  for (var i = 0; i < len; i++) {
    arr.push(value);
  }
  return arr;
}

// Comma formatting
// https://stackoverflow.com/questions/2901102/how-to-print-a-number-with-commas-as-thousands-separators-in-javascript
function parseCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

// Currency formatting
function parseCurrency(value){
	return "$" + parseCommas(parseFloat(value).toFixed(2));
}

// Percentage formatting
function parsePercentage(value){
	return parseCommas(parseFloat(value).toFixed(2)) + "%";
}
</script>

</body>
</html>